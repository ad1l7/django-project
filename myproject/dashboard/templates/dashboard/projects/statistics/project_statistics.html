{% extends 'dashboard/projects/base/project_base.html' %}

{% block content %}
<div class="container mt-4">
  <h2><i class="fas fa-chart-bar"></i> Statistics</h2>

  <div class="table-responsive mt-4">
    <table id="stats-table" class="table table-bordered table-striped table-hover">
<thead class="table-dark">
  <tr>
    <th>–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ üîΩ<br>
      <select class="form-select form-select-sm filter" data-column="0">
        <option value="">–í—Å–µ</option>
        {% for item in statistics %}
          <option value="{{ item.name }}">{{ item.name }}</option>
        {% endfor %}
      </select>
    </th>
    <th>–†–æ–ª—å üîΩ<br>
      <select class="form-select form-select-sm filter" data-column="1">
        <option value="">–í—Å–µ</option>
        <option value="üë®‚Äçüíº –î–∏—Ä–µ–∫—Ç–æ—Ä">üë®‚Äçüíº –î–∏—Ä–µ–∫—Ç–æ—Ä</option>
        <option value="üßë‚Äçüíº –ê–¥–º–∏–Ω">üßë‚Äçüíº –ê–¥–º–∏–Ω</option>
        <option value="üë∑ –†–∞–±–æ—Ç–Ω–∏–∫">üë∑ –†–∞–±–æ—Ç–Ω–∏–∫</option>
      </select>
    </th>
    <th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á üîΩ<br>
      <select class="form-select form-select-sm range-filter" data-column="2">
        <option value="">–í—Å–µ</option>
        <option value=">10">&gt;10</option>
        <option value=">30">&gt;30</option>
        <option value=">50">&gt;50</option>
        <option value=">70">&gt;70</option>
        <option value=">100">&gt;100</option>
      </select>
    </th>
    <th>–û—Ç–º–µ–Ω–µ–Ω–æ –∑–∞–¥–∞—á üîΩ<br>
      <select class="form-select form-select-sm range-filter" data-column="3">
        <option value="">–í—Å–µ</option>
        <option value=">10">&gt;10</option>
        <option value=">30">&gt;30</option>
        <option value=">50">&gt;50</option>
        <option value=">70">&gt;70</option>
        <option value=">100">&gt;100</option>
      </select>
    </th>
    <th>–ù–∞–≥—Ä–∞–¥–∞ (–±–∞–ª–ª—ã) üîΩ<br>
      <select class="form-select form-select-sm range-filter" data-column="4">
        <option value="">–í—Å–µ</option>
        <option value=">10">&gt;10</option>
        <option value=">30">&gt;30</option>
        <option value=">50">&gt;50</option>
        <option value=">70">&gt;70</option>
        <option value=">100">&gt;100</option>
      </select>
    </th>
    <th>–í—Å–µ–≥–æ –∑–∞–¥–∞—á üîΩ<br>
      <select class="form-select form-select-sm range-filter" data-column="5">
        <option value="">–í—Å–µ</option>
        <option value=">10">&gt;10</option>
        <option value=">30">&gt;30</option>
        <option value=">50">&gt;50</option>
        <option value=">70">&gt;70</option>
        <option value=">100">&gt;100</option>
      </select>
    </th>
  </tr>
</thead>
      <tbody>
        {% for item in statistics %}
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.role }}</td>
          <td>{{ item.done }}</td>
          <td>{{ item.canceled }}</td>
          <td>{{ item.reward }}</td>
          <td>{{ item.total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

<script>
  $(document).ready(function () {
    const table = $('#stats-table').DataTable({
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/ru.json'
      },
      orderCellsTop: true,
      fixedHeader: true
    });

    // –¢–æ—á–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä (–∏–º—è –∏ —Ä–æ–ª—å)
    $('.filter').on('change', function () {
      const colIndex = $(this).data('column');
      table.column(colIndex).search(this.value).draw();
    });

    // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É (> N)
    $('.range-filter').on('change', function () {
      const colIndex = $(this).data('column');
      const threshold = parseInt(this.value.replace('>', ''));

      table.column(colIndex).search('').draw(); // —Å–±—Ä–æ—Å
      table.rows().every(function () {
        const value = parseInt(this.data()[colIndex]);
        if (!isNaN(threshold)) {
          if (value > threshold) {
            $(this.node()).show();
          } else {
            $(this.node()).hide();
          }
        } else {
          $(this.node()).show();
        }
      });
    });
  });
</script>
{% endblock %}
