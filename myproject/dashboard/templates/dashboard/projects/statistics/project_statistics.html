{% extends 'dashboard/projects/base/project_base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

  <!-- üìä –¢–∞–±–ª–∏—Ü–∞ -->
  <div class="table-responsive mt-3">
    <table class="table table-sm table-bordered table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞</th>
          <th>–†–æ–ª—å</th>
          <th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á</th>
          <th>–û—Ç–º–µ–Ω–µ–Ω–æ –∑–∞–¥–∞—á</th>
          <th>–ù–∞–≥—Ä–∞–¥–∞</th>
          <th>–í—Å–µ–≥–æ</th>
        </tr>
      </thead>
      <tbody>
        {% for item in statistics %}
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.role }}</td>
          <td>{{ item.done }}</td>
          <td>{{ item.canceled }}</td>
          <td>{{ item.reward }}</td>
          <td>{{ item.total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–µ–¥–ª–∞–π–Ω–æ–≤ -->
  <hr class="my-4">
  <h5 class="mb-3"><i class="fas fa-calendar-alt"></i> –î–µ–¥–ª–∞–π–Ω—ã –∑–∞–¥–∞—á</h5>
  <div id="calendar" class="mb-4"></div>
</div>
{% endblock %}

{% block extra_css %}

<style>
  /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
  #calendar {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding: 15px;
    max-width: 100%;
    margin: auto;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
  .fc .fc-toolbar-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #333;
  }

  /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
  .fc .fc-button {
    font-size: 0.85rem;
    padding: 6px 12px;
    border-radius: 4px;
    background-color: #f1f3f5;
    color: #333;
    border: 1px solid #ddd;
    transition: all 0.2s ease-in-out;
  }

  .fc .fc-button:hover {
    background-color: #e9ecef;
    border-color: #ccc;
  }

  .fc .fc-button.fc-button-active {
    background-color: #0d6efd !important;
    color: #fff !important;
    border-color: #0d6efd !important;
  }

  /* –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π */
  .fc .fc-daygrid-day-number {
    font-size: 0.9rem;
    color: #555;
  }

  /* –°–æ–±—ã—Ç–∏—è */
  .fc-event {
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: 4px;
    color: #fff;
    background-color: #0d6efd;
    border: none;
    cursor: pointer;
  }

  /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è */
  .fc .fc-day-today {
    background-color: #f8f9fa !important;
  }

  /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ */
  @media (max-width: 768px) {
    .fc .fc-toolbar-title {
      font-size: 1rem;
    }

    .fc .fc-button {
      font-size: 0.75rem;
      padding: 4px 8px;
    }
  }

</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ru',
      height: 400, // –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞
      aspectRatio: 1.5, // –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω
      headerToolbar: {
        left: 'prev,next',
        center: 'title',
        right: 'today'
      },
      buttonText: {
        today: '–°–µ–≥–æ–¥–Ω—è'
      },
      events: {{ calendar_events|safe }},
      eventContent: function(arg) {
        // –ö–∞—Å—Ç–æ–º–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –ª–∏—à–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        return {
          html: `<div class="fc-event-title">${arg.event.title}</div>`
        };
      },
      dayHeaderContent: function(arg) {
        // –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
        return arg.text.substring(0, 2);
      }
    });
    calendar.render();
  });
</script>
{% endblock %}